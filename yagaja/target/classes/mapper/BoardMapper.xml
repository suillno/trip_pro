<?xml version="1.0" encoding="UTF-8"?>

<!-- MyBatis에서 사용할 매퍼 설정: DTD(Document Type Definition) 명시 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 이 XML 파일이 연결될 Mapper 인터페이스 지정 -->
<mapper namespace="com.trip.webpage.mapper.BoardMapper">

<!--  1건 조회 쿼리  2025-05-22 조윤호   -->
<select id="selectOne" parameterType="Long" resultType="BoardDefaultVO"> SELECT * FROM BOARD_DEFAULT WHERE BOD_IDX = #{bodIdx} </select>

<!--  목록 조회 쿼리  -->
<select id="selectList" parameterType="SearchHelper" resultType="BoardDefaultVO">
SELECT * FROM BOARD_DEFAULT WHERE 1 = 1
<if test="cate != null and cate != ''"> AND cate = #{cate} </if>
<if test="bodIdx != null and bodIdx != ''"> AND BOD_IDX = #{bodIdx} </if>
<if test="userId != null and userId != ''"> AND USER_ID LIKE '%' || #{userId} || '%' </if>
<if test="bodTitle != null and bodTitle != ''"> AND BOD_TITLE LIKE '%' || #{bodTitle} || '%' </if>
ORDER BY REG2_DATE DESC
</select>

<!--  목록 카운트 쿼리   2025-05-22 조윤호   -->
<select id="selectListCount" parameterType="SearchHelper" resultType="int">
SELECT COUNT(*) AS CNT FROM BOARD_DEFAULT
<where>
<if test="cate != null"> AND cate = #{cate} </if>
<if test="bodIdx != null"> AND BOD_IDX = #{bodIdx} </if>
<if test="userId != null and userId != ''"> AND USER_ID = #{userId} </if>
</where>
ORDER BY BOD_IDX DESC
</select>

<!-- 기본정보 들어가는 자료형 삭제함  2025-05-22 조윤호  -->
<!-- 2025-05-26 조윤호  이거 전부 복사 -->
<insert id="insertBoard" parameterType="BoardDefaultVO" useGeneratedKeys="true" keyProperty="bodIdx" keyColumn="BOD_IDX"> INSERT INTO BOARD_DEFAULT ( BOD_TITLE, BOD_CONSTENT, user_id, reg2_date, update_date, CATE, REG_ID, UPDATE_ID ) VALUES ( #{bodTitle}, #{bodConstent}, #{userId}, #{reg2Date}, #{updateDate}, #{cate}, #{regId}, #{regId} ) </insert>

<!-- 2025-05-22 조윤호  id선택해서 불러오는 디비설계 아마 삭제 될것같음 -->
<select id="selectLatestByUserId" resultType="BoardDefaultVO" parameterType="String"> 
	SELECT b.BOD_IDX, b.BOD_TITLE, b.REG2_DATE AS createdAt, m.USER_NAME FROM BOARD_DEFAULT b JOIN MEMBER m ON b.USER_ID = m.USER_ID WHERE b.USER_ID = #{userId} ORDER BY b.REG2_DATE DESC 
</select>

<update id="updateBoard" parameterType="BoardDefaultVO"> 
	UPDATE board_default SET cate = #{cate}, bod_title = #{bodTitle}, bod_constent = #{bodConstent}, 
	update_id = #{updateId}, update_date = NOW(), file_mst_id = #{fileMstId}, user_id = #{userId}, is_visible = #{isVisible} WHERE bod_idx = #{bodIdx} 
</update>

<!-- 2025-05-26 조윤호  글 조회 시 조회수 1 증가 -->
<update id="updateUserCnt" parameterType="long">
    UPDATE board_default 
    SET user_cnt = user_cnt + 1 
    WHERE BOD_IDX = #{bodIdx}
</update>
</mapper>